<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Hiragana Card Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            background-color: #1c1a27;
            margin: 0;
            padding: 0;
        }

        header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background-color: #1c1a27;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            color: #ddf;
        }

        header h1 {
            margin: 0;
            font-size: 1.5em;
        }

        #infoBtn {
            background-color: #888;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1em;
            cursor: pointer;
        }

        #game {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            justify-content: center;
            margin: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        .card {
            width: 100%;
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 8px;
            user-select: none;
            border: none;
            background-color: #ccc;
            transition: background-color 0.3s;
        }

        .card.hira:not(.revealed):not(.matched) {
            background-color: #7268A6;
        }

        .card.romaji:not(.revealed):not(.matched) {
            background-color: #ddf;
        }

        .card.revealed,
        .card.matched {
            background-color: #FFF9DE;
            border: none;
        }

        .card.matched {
            visibility: hidden;
        }

        #infoPanel {
            display: none;
            margin: 10px auto;
            max-width: 700px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        #infoPanel table {
            width: 100%;
            border-collapse: collapse;
            font-size: 20px;
            text-align: center;
        }

        #infoPanel th,
        #infoPanel td {
            font-size: 24px;
            border: 1px solid #ccc;
            padding: 6px;
        }

        #infoPanel th {
            background-color: #f5f5f5;
        }

        #matchedPairs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px auto;
            max-width: 600px;
            gap: 10px;
        }

        .pair-card {
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 6px 10px;
            border-radius: 6px;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 60px;
        }

        .pair-card small {
            font-size: 24px;
            color: #666;
        }

        #restartBtn {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4cafa5;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #restartBtn:hover {
            background-color: #66bcb4;
        }
    </style>
</head>

<body>
    <header>
        <h1>Hiragana Cards</h1>
        <button id="infoBtn">?</button>
    </header>

    <div id="infoPanel"></div>
    <button id="restartBtn" style="display: none;margin: 20px auto;">Play Again</button>
    <div id="game"></div>
    <div id="matchedPairs"></div>

    <script>
        const hiraganaList = [
            { hira: "あ", romaji: "a" }, { hira: "い", romaji: "i" }, { hira: "う", romaji: "u" }, { hira: "え", romaji: "e" }, { hira: "お", romaji: "o" },
            { hira: "か", romaji: "ka" }, { hira: "き", romaji: "ki" }, { hira: "く", romaji: "ku" }, { hira: "け", romaji: "ke" }, { hira: "こ", romaji: "ko" },
            { hira: "さ", romaji: "sa" }, { hira: "し", romaji: "shi" }, { hira: "す", romaji: "su" }, { hira: "せ", romaji: "se" }, { hira: "そ", romaji: "so" },
            { hira: "た", romaji: "ta" }, { hira: "ち", romaji: "chi" }, { hira: "つ", romaji: "tsu" }, { hira: "て", romaji: "te" }, { hira: "と", romaji: "to" },
            { hira: "な", romaji: "na" }, { hira: "に", romaji: "ni" }, { hira: "ぬ", romaji: "nu" }, { hira: "ね", romaji: "ne" }, { hira: "の", romaji: "no" },
            { hira: "は", romaji: "ha" }, { hira: "ひ", romaji: "hi" }, { hira: "ふ", romaji: "fu" }, { hira: "へ", romaji: "he" }, { hira: "ほ", romaji: "ho" },
            { hira: "ま", romaji: "ma" }, { hira: "み", romaji: "mi" }, { hira: "む", romaji: "mu" }, { hira: "め", romaji: "me" }, { hira: "も", romaji: "mo" },
            { hira: "や", romaji: "ya" }, { hira: "ゆ", romaji: "yu" }, { hira: "よ", romaji: "yo" },
            { hira: "ら", romaji: "ra" }, { hira: "り", romaji: "ri" }, { hira: "る", romaji: "ru" }, { hira: "れ", romaji: "re" }, { hira: "ろ", romaji: "ro" },
            { hira: "わ", romaji: "wa" }, { hira: "を", romaji: "wo" }, { hira: "ん", romaji: "n" }
        ];

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        const selected = hiraganaList.sort(() => 0.5 - Math.random()).slice(0, 15);
        const pairs = [];
        selected.forEach(pair => {
            pairs.push({ type: 'hira', value: pair.hira, key: pair.romaji });
            pairs.push({ type: 'romaji', value: pair.romaji, key: pair.romaji });
        });
        shuffle(pairs);

        const game = document.getElementById('game');
        const matchedPairsDiv = document.getElementById('matchedPairs');
        let first = null, second = null, lock = false;
        let matchedCount = 0;
        const TOTAL_PAIRS = 15;

        pairs.forEach((item, i) => {
            const div = document.createElement('div');
            div.className = 'card';
            div.classList.add(item.type);
            div.dataset.type = item.type;
            div.dataset.value = item.value;
            div.dataset.key = item.key;
            div.textContent = '';
            game.appendChild(div);

            div.addEventListener('click', () => {
                if (lock || div.classList.contains('revealed') || div.classList.contains('matched')) return;

                div.classList.add('revealed');
                div.textContent = item.value;

                if (!first) {
                    first = div;
                } else {
                    second = div;
                    lock = true;

                    if (first.dataset.key === second.dataset.key &&
                        first !== second &&
                        first.dataset.type !== second.dataset.type) {

                        setTimeout(() => {
                            first.classList.add('matched');
                            second.classList.add('matched');
                            first.textContent = '';
                            second.textContent = '';

                            const pairDiv = document.createElement('div');
                            pairDiv.className = 'pair-card';
                            pairDiv.innerHTML = `<div>${item.type === 'hira' ? first.dataset.value : second.dataset.value}</div>
                                       <small>${item.type === 'hira' ? second.dataset.value : first.dataset.value}</small>`;
                            matchedPairsDiv.appendChild(pairDiv);

                            matchedCount++;
                            if (matchedCount === TOTAL_PAIRS) {
                                document.getElementById('restartBtn').style.display = 'block';
                            }

                            reset();
                        }, 500);

                    } else {
                        setTimeout(() => {
                            first.classList.remove('revealed');
                            second.classList.remove('revealed');
                            first.textContent = '';
                            second.textContent = '';
                            reset();
                        }, 1000);
                    }
                }
            });
        });

        function reset() {
            [first, second, lock] = [null, null, false];
        }

        document.getElementById('restartBtn').addEventListener('click', () => {
            location.reload();
        });

        document.getElementById('infoBtn').addEventListener('click', () => {
            const panel = document.getElementById('infoPanel');
            if (panel.innerHTML.trim() === '') {
                const grouped = {
                    A: ["a", "i", "u", "e", "o"],
                    K: ["ka", "ki", "ku", "ke", "ko"],
                    S: ["sa", "shi", "su", "se", "so"],
                    T: ["ta", "chi", "tsu", "te", "to"],
                    N: ["na", "ni", "nu", "ne", "no"],
                    H: ["ha", "hi", "fu", "he", "ho"],
                    M: ["ma", "mi", "mu", "me", "mo"],
                    Y: ["ya", "", "yu", "", "yo"],
                    R: ["ra", "ri", "ru", "re", "ro"],
                    W: ["wa", "", "", "", "wo"],
                    N: ["", "", "n", "", ""]
                };

                let table = "<table><thead><tr><th></th><th>A</th><th>I</th><th>U</th><th>E</th><th>O</th></tr></thead><tbody>";

                for (const row in grouped) {
                    table += `<tr><th>${row}</th>`;
                    grouped[row].forEach(r => {
                        const hira = hiraganaList.find(h => h.romaji === r)?.hira || "";
                        table += `<td>${hira ? `${hira}<br><small>${r}</small>` : ""}</td>`;
                    });
                    table += `</tr>`;
                }

                table += "</tbody></table>";
                panel.innerHTML = table;
                panel.style.display = "block";
            } else {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }
        });
    </script>
</body>
</html>
